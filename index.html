<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üìêMalla Interactiva Arquitectura UVüèõÔ∏è</title>

  <!-- PWA -->
  <link rel="manifest" href="data/manifest.json" />
  <meta name="theme-color" content="#5cb85c" />
  <link rel="icon" href="data/icon-192.png" type="image/png" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-title" content="Malla Arqui UV" />
  <link rel="apple-touch-icon" href="data/icon-192.png" />
  <meta name="mobile-web-app-capable" content="yes" />

  <!-- CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css"/>
  <link rel="stylesheet" href="data/style.css" />
</head>
<body>

  <!-- T√çTULO -->
  <header class="container text-center my-4">
    <h1 class="fw-bold display-5">üìê Malla Interactiva Arquitectura UV üèõÔ∏è</h1>
  </header>

  <!-- APP -->
  <div class="container mb-5">
    <div id="app">
      <!-- üëá TEMPLATE PEGADO DESDE main.js üëá -->
      <div>
        <!-- PROGRESO Y PROMEDIO GENERAL -->
        <div class="progreso">
          <strong>Avance:</strong> {{ creditosAprobados }} / {{ totalCreditos }} cr√©ditos ({{ avance }}%)<br/>
          <strong>Promedio general:</strong> {{ promedioGeneral }}
          <div class="progress-bar">
            <div class="progress-bar-fill" :style="{ width: avance + '%' }"></div>
          </div>
        </div>

        <!-- BOTONES -->
        <div class="botones no-print">
          <button @click="resetear" class="danger">Reiniciar avance</button>
          <button @click="toggleModo" class="toggle-mode">Modo {{ modo === 'oscuro' ? 'Claro' : 'Oscuro' }}</button>
          <button @click="exportarPDF" class="success">Exportar a PDF</button>
          <button @click="filtro = 'todos'">Ver todos</button>
          <button @click="filtro = 'aprobados'">Ver aprobados</button>
          <button @click="filtro = 'faltantes'">Ver faltantes</button>
        </div>

        <!-- MALLA -->
        <div class="malla-horizontal">
          <div v-for="(ramos, semestre) in semestres" :key="semestre" class="semestre">
            <h2>{{ semestre.toUpperCase() }}</h2>
            <div class="ramos">
              <div
                v-for="ramo in ramos"
                v-if="cumpleFiltro(ramo)"
                :key="ramo[1]"
                class="ramo"
                :style="{ backgroundColor: getColor(ramo[4]) }"
                :class="{ 
                  aprobado: estaAprobado(ramo[1]), 
                  desactivado: !puedeTomarse(ramo)
                }"
                @click="toggleAprobado(ramo[1])"
              >
                <div class="ramo-header">
                  <span>{{ ramo[1] }}</span>
                  <span>{{ ramo[2] }}cr</span>
                </div>
                <div class="ramo-body">
                  {{ ramo[0] }}
                </div>
                <div class="ramo-footer">
                  <span class="badge" v-if="ramo[5].length > 0">
                    {{ cuentaAprobados(ramo[5]) }}/{{ ramo[5].length }}
                  </span>
                  <span class="badge" v-else>‚úì</span>
                  <input
                    v-if="estaAprobado(ramo[1])"
                    class="badge promedio-input"
                    :value="promedios[ramo[1]]"
                    @click.stop
                    @input="guardarPromedio(ramo[1], $event.target.value)"
                    placeholder="Nota"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- CALCULADORA DE NOTAS -->
        <div class="calculadora">
          <h3 class="text-center mb-3">üìä Calculadora de Notas</h3>
          <div class="formulario-notas">
            <div class="nota-item" v-for="(item, index) in notas" :key="index">
              <input type="number" v-model.number="item.nota" placeholder="Nota" min="1" max="7" step="0.1" />
              <input type="number" v-model.number="item.porcentaje" placeholder="%" min="0" max="100" />
              <button class="danger" @click="eliminarNota(index)">üóëÔ∏è</button>
            </div>
            <button class="success" @click="agregarNota">Agregar Nota</button>
          </div>
          <div class="mt-3">
            <label for="notaDeseada"><strong>Nota deseada:</strong></label>
            <input id="notaDeseada" type="number" v-model.number="notaDeseada" min="1" max="7" step="0.1" />
            <p><strong>Ponderaci√≥n actual:</strong> {{ ponderacionActual }}%</p>
            <p><strong>Promedio actual:</strong> {{ promedioActual.toFixed(2) }}</p>
            <p><strong>Nota necesaria para llegar a {{ notaDeseada }}:</strong> {{ notaNecesaria }}</p>
          </div>
        </div>

        <!-- TABLA DE PROMEDIOS -->
        <div class="tabla-promedios">
          <h3 class="text-center mb-3">üìò Promedios por Ramo Aprobado</h3>
          <table>
            <thead>
              <tr>
                <th>Ramo</th>
                <th>C√≥digo</th>
                <th>Nota</th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="ramo in todosLosRamos()" v-if="estaAprobado(ramo[1])">
                <td>{{ ramo[0] }}</td>
                <td>{{ ramo[1] }}</td>
                <td>
                  <input
                    type="number"
                    :value="promedios[ramo[1]]"
                    @input="guardarPromedio(ramo[1], $event.target.value)"
                    placeholder="Nota"
                    min="1" max="7" step="0.1"
                  />
                </td>
              </tr>
            </tbody>
          </table>
          <div class="text-center mt-3">
            <strong>Promedio general (ramos aprobados):</strong> {{ promedioGeneral }}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- LIBRER√çAS JS -->
  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue-chartjs@3.5.1/dist/vue-chartjs.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- ARCHIVO PRINCIPAL -->
  <script src="data/main.js" defer></script>

  <!-- SERVICE WORKER -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('data/service-worker.js')
          .then(reg => console.log('‚úî Service Worker registrado:', reg))
          .catch(err => console.warn('‚úò Error al registrar Service Worker:', err));
      });
    }
  </script>
</body>
</html>
